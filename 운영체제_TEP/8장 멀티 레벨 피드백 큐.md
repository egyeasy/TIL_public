# 8. 스케줄링 : 멀티 레벨 피드백 큐

Multi-level FeedBack Queue



### MLFQ가 해결하고자 하는 문제

1. 짧은 작업을 먼저 실행시켜 반환 시간을 최적화
2. 대화형 사용자에게 응답이 빠른 시스템이라는 느낌을 주기 위해 응답 시간을 최적화



## 8.1 MLFQ: 기본 규칙

MLFQ는 여러 개의 큐로 구성되며, 각각 다른 우선 순위를 가진다.

큐에 둘 이상의 작업이 존재할 수 있으며,  같은 우선순위의 큐에서는 Round-Robin 스케줄링 알고리즘이 사용된다.

- 규칙 1 : Priority(A) > Priority(B) 이면, A가 실행된다.
- 규칙 2 : Priority(A) = Priority(B) 이면, A와 B는 RR 방식으로 실행된다.



## 8.2 시도 1: 우선 순위의 변경

작업의 우선순위는 동적으로 바뀐다.



- 규칙 3 : 작업이 시스템에 진입하면, 가장 높은 우선 순위, 즉 맨 위의 큐에 놓여진다.
- 규칙 4a : 주어진 타임 슬라이스를 모두 사용하면 우선순위는 낮아진다. 즉, 한 단계 아래 큐로 이동한다.
- 규칙 4b : 타임 슬라이스를 소진하기 전에 CPU를 양도하면 같은 우선순위를 유지한다.



규칙 4b에 의해 대화형 작업이 입출력을 자주 수행하면 동일한 우선순위를 유지하게 한다.



하지만 이러한 규칙들에 의해 발생하는 문제는 다음과 같다.

1. **기아 상태(starvation)**이 발생할 수 있다. 너무 많은 대화형 작업이 존재하면 이들이 모든 CPU 시간을 소모하게 됨
2. 스케줄러가 자신에게 유리하게 동작하도록 프로그램을 작성하게 될 수 있다. e.g. 불필요하게 입출력을 요청해서 CPU를 양도하면서 우선 순위 유지



## 8.3 시도 2: 우선 순위의 상향 조정

1의 **기아 문제**를 해결하는 방법

- 규칙 5 : 일정 기간 S가 지나면, 시스템의 모든 작업을 최상위 큐로 이동시킨다.

S 값의 결정에는 정답이 없다(부두 상수)



## 8.4 시도 3: 더 나은 시간 측정

2의 스케줄러를 자신에게 유리하게 동작하도록 만드는 문제를 야기하는 규칙은 4a, 4b이다.

이 규칙을 변경하여 MLFQ의 각 단계에서 CPU 총 사용 시간을 측정하는 방법을 생각해볼 수 있다.

- 규칙 4 : 주어진 단계에서 시간 할당량을 소진하면 (CPU를 몇 번 양도하였는지 상관없이), 우선 순위는 낮아진다.



## 8.5 MLFQ 조정과 다른 쟁점들

- 필요한 변수들을 스케줄러가 어떻게 설정해야 하는가? - 큐의 개수, 타임 슬라이스 크기, 우선순위 상향 조정 빈도

  -> 워크로드에 대해 충분히 경험하고 조정해나가면서 균형점을 찾아야 한다.