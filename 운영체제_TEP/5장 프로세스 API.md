## 5. 막간: 프로세스 API

운영체제 API를 통해 프로세스를 생성하고 제어하는 법에 대해 알아보자.

### 5.1 fork() 시스템 콜

프로세스를 생성하는 데 쓰이는 시스템 콜.

생성된 프로세스는 호출한 프로세스의 **복사본**이 된다.



#### 자식 프로세스 특징

- 프로세스를 호출한 line부터 실행된다.

- 자신의 주소 공간, 레지스터, PC 값을 갖는다.
- fork() 시스템 콜의 반환 값이 다르다. -> 자식은 0, 부모는 자식의 PID



사실, 프로세스 fork가 이뤄진 이후 어느 프로세스가 먼저 실행되는지는 비결정적(nondeterminism)이다. 이는 CPU 스케쥴러가 결정하게 된다.



### 5.2 wait() 시스템 콜

부모 프로세스는 wait 시스템 콜을 통해 자식 프로세스 종료 시점까지 자신의 실행을 잠시 중지시킨다. 자식 프로세스가 종료되면 wait는 리턴한다.



### 5.3 exec() 시스템 콜

복사본이 아닌 다른 프로그램을 실행해야할 경우에 사용



#### 수행 과정

1. 실행 파일의 코드와 정적 데이터를 읽어들여 현재 실행 중인 코드 세그먼트와 정적 데이터 부분을 덮어쓴다.
2. 힙과 스택 및 프로그램의 다른 주소 공간들도 초기화된다.
3. 운영체제는 argv 등의 인자를 전달하여 프로그램 실행
4. exec을 실행한 프로세스에서 exec 이후의 부분은 실행되지 않는다.



### 5.4 왜, 이런 API를?

UNIX의 쉘을 구현하기 위해서는 fork()와 exec()을 분리해야 한다.

그래야 쉘이 fork()를 호출하고 exec()을 호출하기 전에 코드를 실행해서 프로그램의 환경을 설정하고 다양한 기능을 준비할 수 있다.

쉘에 명령어 입력 -> fork()를 통해 자식 프로세스 생성 -> exec()을 통해 프로그램 실행 -> wait()을 통해 명령어 끝나기를 기다림 -> 자식 종료되면 wait()로부터 리턴 -> 프롬프트 출력 및 명령어 대기



### 5.5 여타 API들

kill() 시스템 콜은 프로세스에게 **시그널**을 보내는 데 사용.

시그널 : 프로세스를 중단(block)시키고, 삭제하는 등의 작업에 사용되는, 외부 사건을 프로세스에게 전달하는 역할을 함





